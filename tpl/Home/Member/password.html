<!doctype html>
<html class="no-js">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><!--读取IE最新渲染-->
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<title>去拍房</title>
<include file="Home/Public/load"/>
</head>

<body class="public_color">
<include file="Home/Public/header"/>
<section class="secondhand_side">
	<div class="secondhand_tit">
		<i class="iconfont">&#xe69e;</i>
		<a href="{:U('Index/index')}">首页</a> <i class="iconfont">&#xe60d;</i>
		<a href="{:U('Member/index')}">我的账户</a><i class="iconfont">&#xe60d;</i>
		<a href="{:U('Member/base_info')}">个人资料</a><i class="iconfont">&#xe60d;</i>
		修改密码
	</div>
	<div class="secondhand_side_info">
		<include file="Home/Member/member_nav"/>
		<article class="basic_info_right">
			<div class="basic_info_right_tit">
				<ul>
					<li>
						<a href="{:U('Member/base_info')}">
							基本信息
						</a>
					</li>
					<li class="basic_sub">
						<a href="{:U('Member/password')}">
							修改密码
						</a>
					</li>
					<li>
						<a href="{:U('Member/pay_password')}">
							支付密码
						</a>
					</li>
				</ul>
				<div class="clear"></div>
			</div>
			<div class="basic_info_side password_side">
				<form action="{:U('Member/password')}" method="post" id="password_form">
					<ul>
						<li>
							<label>验证码：</label>
							<input type="input" name="sms_code">
							<button type="button" onclick="sendsms(this)">获取短信验证码</button>
							<div class="clear"></div>
						</li>
						<li>
							<label>新密码：</label>
							<input type="password" name="password">
							<div class="clear"></div>
						</li>
						<li>
							<label>确认密码：</label>
							<input type="password" name="repassword">
							<div class="clear"></div>
						</li>
					</ul>
					<div class="button_at password_button">
						<button class="preservate" type="submit">确认修改</button>
						<button class="reset" type="reset">取消</button>
					</div>
				</form>
			</div>
		</article>
		<div class="clear"></div>
	</div>
</section>

<include file="Home/Public/footer"/>
<script>
	$("#password_form").Validform({
	    tiptype:function(msg,o,cssctl){
	        if (o.type == 3)
	        layer.msg(msg, {icon:5});
	    },
	    ajaxPost:true,
	    callback:function(result){
	    	//console.log(result);
	        if(result.status == 1){
	            layer.msg(result.msg, {icon:6}, function(){ 
	                location.href=result.url;
	            });
	        } else {
	            layer.msg(result.msg, {icon:5});
	        }
	    }
	});
	var wait = 60;
	//异步发送短信
   	function sendsms(obj){
   		var mobile = "{$member.mobile}";
    	//验证码正确
    	time($(obj));
    	//发送短信验证码
    	$.get("{:U('Member/ajax_sendsms')}",{mobile:mobile},function(data){
			console.log(data);
			if(data.status == 1){
				layer.msg('短信已发送，请注意查收');
			}
		},"json");
   	}
   	//发送短信验证码
   	function time(o) {
   		if (wait == 0) {
   			o.attr('onclick','sendsms(this)');
   			o.text('获取验证码');
   			wait = 60;
   		} else {
   			o.removeAttr('onclick');
   			o.text("重新发送(" + wait + ")");
   			wait--; 
   			setTimeout(function() {
   				time(o);
   			},
   			1000)
   		}
   	}
</script>
</body>
</html>
