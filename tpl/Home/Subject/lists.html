<!doctype html>
<html class="no-js">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><!--读取IE最新渲染-->
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<title>去拍房</title>
<include file="Home/Public/load"/>
</head>

<body>
<include file="Home/Public/header"/>

<section class="news_side home_side">
	<div class="second_ban">
		<img src="images/secondhand_list_ban.jpg" alt="">
	</div>
	<section class="auction_data">
		<div id="wrap">
			<div id="top" class="subject_screen">
				<p id='model' data-name="sale_type">
					<font>拍卖类型</font>
					{:getScreen($Config['stat_sale_type']['value'])}
				</p>
				<p id='color' data-name="c_id">
					<font>标的物类型</font>
					<span data-value="0" class="on">不限</span>
					<volist name="subject_category" id="vo" >
					    <span data-value="{$vo.id}">{$vo.name}</span>
					</volist>
				</p>
				<p id='rom' data-name="city_id">
					<font>标的所在地</font>
					<span data-value="0" class="on">不限</span>
					<volist name="subject_city" id="vo">
						<span data-value="{$vo.id}">{$vo.name}</span>
					</volist>
				</p>
				<p id='banben' data-name="status">
					<font>拍卖状态</font>
					{:getScreen($Config['stat_status']['value'])}
				</p>
				<p id='time' data-name="start_time">
					<font>开拍时间</font>
					<span data-value="0" class="on">不限</span>
					<span data-value="3">最近3天</span>
					<span data-value="7">最近7天</span>
					<span data-value="30">最近30天</span>
				</p>
			</div>
			<div class="wrap_time">
				
			</div>
		</div>
	</section>

	<section class="second_screen">
		<div class="second_screen_num">
			拍卖（<span>8888888</span>）
		</div>
		<div class="second_screen_price">
			<span>价格</span>
			<div class="second_screen_price1">
				<label>￥</label><input type="text">
			</div> <em>一</em>
			<div class="second_screen_price1">
				<label>￥</label><input type="text">
			</div>
			<div class="clear"></div>
		</div>
		<div class="second_screen_data">
			<span class="default">默认</span>
			<span>价格<i class="iconfont">&#xe620;</i></span>
			<span>出价次数<i class="iconfont">&#xe620;</i></span>
		</div>
		<div class="clear"></div>
	</section>

	<section class="news_side_list">
		<div class="ashooting_side_end ashooting_side_end2">
			<div class="home_auction_list home_auction_list2">
				<ul id="list_total" data-total="1">
					
				</ul>
				<div class="clear"></div>
				<div class="loadmore">加载更多</div>
			</div>
		</div>
	</section>
</section>

<include file="Home/Public/footer"/>
<script>
	$(function(){
		$('.second_screen_data span').click(function(){
			$(this).addClass('default').siblings().removeClass('default')
		})
	})
</script>
<script id="storyTemplate" type="text/html">
    {{each list as value key}}
    <li>
		<a href="{{value.linkurl}}">
			<figure>
				<img src="{{value.image}}" alt="">
				<figcaption>
					<div class="shelves_info home_auction_list_info">
						<h4>{{value.title}}</h4>
						<p><span>当前价</span><b>¥ {{value.current_price}}万</b></p>
						<p><span>评估价</span>  ¥{{value.evaluate_price}} 万 &nbsp;&nbsp;&nbsp;&nbsp; <span>出价数</span>{{value.bid_count}}次</p>
						<p><span>预 计</span>  <em>{{value.endtime_yearmonth}}</em><em>{{value.endtime_time}}</em>结束</p>
					</div>
					<div class="hali_num">
						<dl>
							<dd>
								<span>{{value.onlook}}</span>次围观
							</dd>
							<dd>
								<span>{{value.bond_count}}</span>次报名
							</dd>
							<div class="clear"></div>
						</dl>
					</div>
			</figure>
		</a>
		<div class="home_auction_list_move">
			{{if value.sale_type == 1}}
			<div class="col_t_l col_t_left2">
				<i  class="iconfont">&#xe79b;</i>一口价
			</div>
			{{/if}}
			<div class="collect_auction {{value.is_collection?'current':''}}" data-status="{{value.is_collection}}" onclick="collection(this,{{value.id}})">
				<i class="iconfont">&#xe604;</i>
			</div>
			<div class="clear"></div>
		</div>
		<div class="conducts_tip conducts_tip2">
			{{if value.status == 1}}
				<img src="images/soon.png" alt="">
			{{/if}}
			{{if value.status == 2}}
				<img src="images/conduct.png" alt="">
			{{/if}}
			{{if value.status == 3}}
				<img src="images/over.png" alt="">
			{{/if}}
		</div>
	</li>
    {{/each}}
</script>
<script type="text/javascript">
    var page = 1;
    var loading = false;
    var ajax_url = "{:U('Subject/ajax_list')}";
    $(function() {
        $(window).scroll(function() {
            if($(document).height() - $(this).scrollTop() - $(this).height() < 160) {
            	var count = $('#list_total').children('li').length;
            	var total = $('#list_total').data('total');
            	if(count < total){
            		loadMore('scroll');
            	}
            }
        });
        $('.subject_screen span').click(function(){
        	var data = "";
        	$(this).addClass('on').siblings('span').removeClass('on');
        	$('.subject_screen span').each(function(){
        		var _this = $(this);
        		var _value;
        		var _name;
        		if(_this.hasClass('on')){
        			_value = _this.data('value');
        			_name = _this.closest('p').data('name');
        			data += _name+':'+_value+',';
        		}
        	});
        	page = 1;
        	loadMore(data);
        })
    });
    function loadMore(data){
    	$.get(ajax_url,{ajax:data,p:page},function(result){
    		//console.log(result.data);
    		var count = $('#list_total').data('total',result.data.count);
    		if(data != 'scroll'){
    			$("#list_total").empty();
    		}
    		if(result.data.list){
    			page++;
    			$("#list_total").append(template("storyTemplate", {
                    list: result.data.list
                }));
    		}
    	},'json')
    }
    loadMore('');
    //收藏
	function collection(obj,s_id){
	    var status = $(obj).data('status');
	    console.log(status);
	    $.get("{:U('Subject/turnUrl')}",{
	        action:'collection',
	        s_id:s_id,
	        status:status
	    },function(result){
	        console.log(result);
	        if(result.status == 1){
	            layer.msg(result.msg,{icon:6},function(){
	                if(status == 0){
	                    $(obj).addClass('current').data('status',1);
	                }else{
	                    $(obj).removeClass('current').data('status',0);
	                }
	            });
	        }else if(result.status == 2){
	        	layer.msg(result.msg,{icon:5},function(){
	        		$('.sign_side3').fadeIn();
	        	});
	    	}else{
	            layer.msg(result.msg,{icon:5});
	        }
	    },'json');
	}
</script>
</body>
</html>
