<include file="Public/header"/>
<div class="layui-tab-brief main-tab-container">
    <ul class="layui-tab-title main-tab-title">
      <a href="{:U('index')}"><li>管理员列表</li></a>
      <a href="{:U('edit')}"><li>添加管理员</li></a>
      <a href="{:U('role')}"><li>角色列表</li></a>
      <a href="{:U('role_edit')}"><li class="layui-this">添加 / 编辑角色</li></a>
      <div class="main-tab-item">管理员管理</div>
    </ul>
    <div class="layui-tab-content">
      <div class="layui-tab-item layui-show">
        <form class="layui-form">
          <div class="layui-tab layui-tab-card">
            <ul class="layui-tab-title">
              <li class="layui-this">基本选项</li>
            </ul>
            <div class="layui-tab-content">
              <div class="layui-tab-item layui-show">
                {:Form::input('text','name',$info['name'],'名称','','','required')}
                {:Form::input('text','remark',$info['remark'],'说明','','','')}
                <div class="layui-form-item">
                  <label class="layui-form-label">节点</label>
                  <div class="layui-input-inline input-custom-width">
                    <volist name="nodes" id="vo">
                      <input type="checkbox" name="nodes[{$i}]" value="{$vo.id}" data-pid="{$vo.pid}" lay-skin="primary" lay-filter="nodes_checkbox" {:in_array($vo['id'],explode(',',$info['nodes']))?'checked':''}/>
                      {$vo.title_show}{$vo.name}<br>
                    </volist>
                  </div>
                </div>
              </div>
              <div class="layui-form-item">
                <div class="layui-input-block">
                  <input type="hidden" name="id" value="{$info.id}"/>
                  <button class="layui-btn" lay-submit="" lay-filter="form_submit">保存</button>
                </div>
              </div>
            </div>
          </div>
        </form>
      </div>
    </div>
</div>
<script type="text/javascript">
layui.use(['element', 'form'], function(){
  var element = layui.element()
  ,form = layui.form()
  ,jq = layui.jquery;

  form.on('checkbox(nodes_checkbox)', function(data){
    var self = data.elem,
        is_checked = data.elem.checked,
        value = data.value,
        pid = data.elem.dataset.pid;
    $('.layui-form-checkbox').each(function(){
      var input = $(this).prev('input');
      var _pid = input.data('pid');
      var _id = input.val();
      if(pid == 0){
        if(is_checked){
          if(value == _pid){
            input.attr('checked','true');
            $(this).addClass('layui-form-checked');
          }
        }else{
          if(value == _pid){
            input.removeAttr('checked');
            $(this).removeClass('layui-form-checked');
          }
        }
      }else{
        if(pid == _id){
          input.attr('checked','true');
          $(this).addClass('layui-form-checked');
        }
      }
    })
  });
  
  //监听提交
  form.on('submit(form_submit)', function(data){
    loading = layer.load(2, {
      shade: [0.2,'#000'] //0.2透明度的白色背景
    });
    var param = data.field;
    jq.post('{:url("edit")}',param,function(data){
      if(data.status == 1){
        layer.close(loading);
        layer.msg(data.msg, {icon: 1, time: 1000}, function(){
          location.reload();//do something
        });
      }else{
        layer.close(loading);
        layer.msg(data.msg, {icon: 2, anim: 6, time: 1000});
      }
    });
    return false;
  });
  
})
</script>
</body>
</html>

